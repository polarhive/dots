#!/bin/sh
q=$(wofi -d)
cd ~/.local/share/.Music/.tmp && rm *.opus

notify-send "searching: $q"
id=$(yt-dlp --default-search "https://music.youtube.com/search?q=" "$q" --playlist-end 1 --get-id)
title=$(yt-dlp --get-title $id)

notify-send "downloading: $title"
yt-dlp --ignore-config $id -f 'ba' -x --add-metadata --restrict-filenames
cp -n *.opus ../.archive

notify-send "playing: $title"
mpc -q update && mpc -q insert .tmp && mpc -q next
