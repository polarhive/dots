#!/bin/sh
q=$(wofi -d)
[ -z "$q" ] && exit 1

# song folder
music_folder="Music" && cd ~/$music_folder/.tmp/dl

# yt-dl
id=$(yt-dlp --default-search "https://music.youtube.com/search?q=" "$q" --playlist-end 1 --get-id)
yt-dlp --parse-metadata "title:%(title)s" --parse-metadata "artist:%(artist)s" --add-metadata -f 'ba' -x --ignore-config -q --progress --restrict-filenames "$id" || notify-send "ERROR" && break

# mpc
rm ~/$music_folder/.tmp/dl/*.part -f
name=$(ls -u | head -1)
mpc -q update && mpc -q add ".tmp/dl/${name}" && mpc -q play
